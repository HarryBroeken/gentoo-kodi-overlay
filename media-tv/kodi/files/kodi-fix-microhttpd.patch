From 73e2d3b1ce59fcf94616726cc245d01be05daee0 Mon Sep 17 00:00:00 2001
From: Daniel Scheller <d.scheller@gmx.net>
Date: Sun, 18 Dec 2016 14:41:56 +0100
Subject: [PATCH] fix build without webserver and without microhttpd installed

---
 xbmc/interfaces/legacy/wsgi/CMakeLists.txt         | 20 +++++-----
 xbmc/network/httprequesthandler/CMakeLists.txt     | 44 +++++++++++-----------
 .../httprequesthandler/python/CMakeLists.txt       | 14 ++++---
 3 files changed, 42 insertions(+), 36 deletions(-)

diff --git a/xbmc/interfaces/legacy/wsgi/CMakeLists.txt b/xbmc/interfaces/legacy/wsgi/CMakeLists.txt
index ccfde18..cc29eb4 100644
--- a/xbmc/interfaces/legacy/wsgi/CMakeLists.txt
+++ b/xbmc/interfaces/legacy/wsgi/CMakeLists.txt
@@ -1,11 +1,13 @@
-set(SOURCES WsgiErrorStream.cpp
-            WsgiInputStream.cpp
-            WsgiResponseBody.cpp
-            WsgiResponse.cpp)
+if(MICROHTTPD_FOUND)
+  set(SOURCES WsgiErrorStream.cpp
+              WsgiInputStream.cpp
+              WsgiResponseBody.cpp
+              WsgiResponse.cpp)
 
-set(HEADERS WsgiErrorStream.h
-            WsgiInputStream.h
-            WsgiResponse.h
-            WsgiResponseBody.h)
+  set(HEADERS WsgiErrorStream.h
+              WsgiInputStream.h
+              WsgiResponse.h
+              WsgiResponseBody.h)
 
-core_add_library(legacy_interface_wsgi)
+  core_add_library(legacy_interface_wsgi)
+endif()
diff --git a/xbmc/network/httprequesthandler/CMakeLists.txt b/xbmc/network/httprequesthandler/CMakeLists.txt
index 0ac98d3..14d863f 100644
--- a/xbmc/network/httprequesthandler/CMakeLists.txt
+++ b/xbmc/network/httprequesthandler/CMakeLists.txt
@@ -1,23 +1,25 @@
-set(SOURCES HTTPFileHandler.cpp
-            HTTPImageHandler.cpp
-            HTTPImageTransformationHandler.cpp
-            HTTPJsonRpcHandler.cpp
-            HTTPPythonHandler.cpp
-            HTTPRequestHandlerUtils.cpp
-            HTTPVfsHandler.cpp
-            HTTPWebinterfaceAddonsHandler.cpp
-            HTTPWebinterfaceHandler.cpp
-            IHTTPRequestHandler.cpp)
+if(MICROHTTPD_FOUND)
+  set(SOURCES HTTPFileHandler.cpp
+              HTTPImageHandler.cpp
+              HTTPImageTransformationHandler.cpp
+              HTTPJsonRpcHandler.cpp
+              HTTPPythonHandler.cpp
+              HTTPRequestHandlerUtils.cpp
+              HTTPVfsHandler.cpp
+              HTTPWebinterfaceAddonsHandler.cpp
+              HTTPWebinterfaceHandler.cpp
+              IHTTPRequestHandler.cpp)
 
-set(HEADERS HTTPFileHandler.h
-            HTTPImageHandler.h
-            HTTPImageTransformationHandler.h
-            HTTPJsonRpcHandler.h
-            HTTPPythonHandler.h
-            HTTPRequestHandlerUtils.h
-            HTTPVfsHandler.h
-            HTTPWebinterfaceAddonsHandler.h
-            HTTPWebinterfaceHandler.h
-            IHTTPRequestHandler.h)
+  set(HEADERS HTTPFileHandler.h
+              HTTPImageHandler.h
+              HTTPImageTransformationHandler.h
+              HTTPJsonRpcHandler.h
+              HTTPPythonHandler.h
+              HTTPRequestHandlerUtils.h
+              HTTPVfsHandler.h
+              HTTPWebinterfaceAddonsHandler.h
+              HTTPWebinterfaceHandler.h
+              IHTTPRequestHandler.h)
 
-core_add_library(network_httprequesthandlers)
+  core_add_library(network_httprequesthandlers)
+endif()
diff --git a/xbmc/network/httprequesthandler/python/CMakeLists.txt b/xbmc/network/httprequesthandler/python/CMakeLists.txt
index 2829019..1aca60a 100644
--- a/xbmc/network/httprequesthandler/python/CMakeLists.txt
+++ b/xbmc/network/httprequesthandler/python/CMakeLists.txt
@@ -1,8 +1,10 @@
-set(SOURCES HTTPPythonInvoker.cpp
-            HTTPPythonWsgiInvoker.cpp)
+if(MICROHTTPD_FOUND)
+  set(SOURCES HTTPPythonInvoker.cpp
+              HTTPPythonWsgiInvoker.cpp)
 
-set(HEADERS HTTPPythonInvoker.h
-            HTTPPythonRequest.h
-            HTTPPythonWsgiInvoker.h)
+  set(HEADERS HTTPPythonInvoker.h
+              HTTPPythonRequest.h
+              HTTPPythonWsgiInvoker.h)
 
-core_add_library(network_httprequesthandlers_python)
+  core_add_library(network_httprequesthandlers_python)
+endif()
